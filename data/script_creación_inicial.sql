-- LOGIN Y USUARIO

CREATE TABLE FUNCION_POR_ROL(
	FUN_ID INT IDENTITY(1,1),
	NOMBRE CHAR,
	ROL INT
)

CREATE TABLE ROLES(
	ROL_ID INT PRIMARY KEY,
	NOMBRE CHAR,
	ESTADO BIT
)

CREATE TABLE INTENTOS_LOGIN(
	INT_ID INT IDENTITY(1,1),
	USUARIO INT,
	FECHA DATE,
	ACCESO BIT -- 1 ES CORRECTO
)

CREATE TABLE PAIS(
	PAI_ID INT PRIMARY KEY,
	NOMBRE CHAR
)

CREATE TABLE ROLES_POR_USUARIO(
	ROL INT,
	USUARIO INT
)

CREATE TABLE USUARIOS(
	USU_ID INT PRIMARY KEY,
	USERNAME CHAR,
	PASSWORD CHAR,
	ESTADO BIT,
	FECHA_ALTA DATE, --TODO FALTA EN EL DER
	FECHA_MODIFICACION DATE, --TODO FALTA EN EL DER
	INTENTOS_FALLIDOS SMALLINT, --RESETEAR CUANDO INGRESA
	PREGUNTA_SECRETA CHAR,
	RESPUESTA CHAR
)

CREATE TABLE PERSONAS(
	PER_ID INT PRIMARY KEY,
	TIPO_DOC VARCHAR(3), --DNI/LE/LC TODO CHECK
	DNI INT, --FIXME ¿INT? ¿NUMERIC(10,0)?
	NOMBRE CHAR,
	APELLIDO CHAR,
	PAIS INT,
	CALLE CHAR,
	PISO INT,
	DEPTO VARCHAR(1), --SIGUIENDO EL ESQUEMA DE LA MAESTRA
	LOCALIDAD INT,
	NACIONALIDAD INT,
	FECHA_NACIMIENTO DATE,
	MAIL CHAR,
	USUARIO INT	
)

CREATE TABLE LOCALIDADES( --FALTA EN EL DER
	LOC_ID INT PRIMARY KEY,
	NOMBRE CHAR
)

-- CUENTAS Y TARJETAS

CREATE TABLE MONEDAS(
	MON_ID INT PRIMARY KEY,
	NOMBRE CHAR
)

CREATE TABLE EMISORES(
	EMI_ID INT PRIMARY KEY,
	NOMRE CHAR
)

CREATE TABLE TIPOS_CUENTA(
	TIP_ID INT PRIMARY KEY,
	NOMBRE VARCHAR(9), --ORO/PLATA/BRONCE/GRATUITA TODO CHECK
	COSTO_MANTENIMIENTO FLOAT,
	COSTO_TRANSACCION FLOAT
)

CREATE TABLE ESTADOS_CUENTA(
	EST_ID INT PRIMARY KEY,
	NOMBRE CHAR,
	FECHA_CIERRE DATE
)

CREATE TABLE CUENTAS(
	CUE_ID INT PRIMARY KEY,
	USUARIO INT,
	PAIS INT,
	MONEDA INT,
	TIPO INT,
	FECHA_ALTA DATE,
	FECHA_EXPIRACION DATE,
	ESTADO INT,
	SALDO FLOAT
)

CREATE TABLE TARJETAS(
	TAR_ID INT PRIMARY KEY,
	PERSONA INT,
	ENCRIPTADO NUMERIC(12,0),
	LIMPIO NUMERIC(4,0), --FIXME ASÍ?
	COD_SEGURIDAD INT,
	EMISOR INT,
	FECHA_EMISION DATE,
	FECHA_VENCIMIENTO DATE,
)

-- OPERACIONES
CREATE TABLE CHEQUES(
	CHE_ID INT IDENTITY(1,1),
	NUMERO INT
)

CREATE TABLE DEPOSITOS(
	DEP_ID INT PRIMARY KEY,
	TARJETA INT
)

CREATE TABLE RETIROS_EFECTIVO(
	RET_ID INT PRIMARY KEY,
	CHEQUE INT
)

CREATE TABLE TRANSFERENCIAS(
	TRA_ID INT PRIMARY KEY,
	CUENTA_DESTINO INT,
	COSTO FLOAT
)

CREATE TABLE OPERACIONES(
	OPE_ID INT PRIMARY KEY,
	CUENTA INT,
	MONEDA INT,
	FECHA DATE,
	IMPORTE FLOAT
)

CREATE TABLE FACTURAS(
	FAC_ID INT PRIMARY KEY,
	OPERACION INT,
	FECHA DATE,
	PAGADO BIT
)